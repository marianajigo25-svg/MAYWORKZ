<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Orden de Servicio - MAYWORKZ</title>

<style>
  :root{
    --page-width: 900px;
    --gap: 14px;
  }

  body { font-family: Arial, sans-serif; background:#f2f2f2; margin:0; }

  /* Contenedores centrados y consistentes */
  .container{
    width: var(--page-width);
    margin: 20px auto;
    background:#fff;
    padding: 20px;
    box-sizing: border-box;
  }

  .header { text-align:center; margin-bottom: 10px; }
  .header img {
    max-width: 500px;
    margin-bottom: -10px;
    display:block;
    margin-left:auto;
    margin-right:auto;
  }
  h2 { margin: -5px; font-size: 28px; letter-spacing: 0.5px; }
  h3 { margin: 18px 0 8px 0; }

  /* Tablas uniformes y centradas */
  table{
    width: 100%;
    border-collapse: collapse;
    margin: 10px auto 0 auto;
    table-layout: fixed; /* ayuda a que no se deformen */
  }
  th, td{
    border:1px solid #000;
    padding:8px;              /* un poquito más aire */
    font-size:14px;
    vertical-align:middle;
    box-sizing: border-box;
  }
  th{ background:#e6e6e6; }

  /* Inputs y textareas uniformes */
  input, textarea{
    width: 100%;
    border: none;
    font-size: 14px;
    outline: none;
    background: transparent;
    box-sizing: border-box;
  }

  textarea{
    border: 1px solid #000;
    padding: 10px;
    width: 100%;
    resize: vertical;
    margin: 8px auto 0 auto;
    display:block;
  }

  /* Textareas con tamaño consistente */
  textarea.trabajo{
    min-height: 110px;
    max-height: 160px;
    line-height: 1.3;
  }
  textarea.obs{
    min-height: 90px;
    max-height: 140px;
    line-height: 1.3;
  }

  .btn{
    padding:10px 18px;
    font-size:16px;
    background:#000;
    color:#fff;
    border:none;
    cursor:pointer;
    margin-top:12px;
  }
  .btn.secondary{ background:#444; }

  .actions{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:10px;
    justify-content: flex-start;
  }

  .total-box td{ font-weight:bold; }

  /* ===== TABLA DATOS: columnas parejitas ===== */
  table.datos td:nth-child(1),
  table.datos td:nth-child(3){
    width: 20%;
    font-weight: 700;
  }
  table.datos td:nth-child(2),
  table.datos td:nth-child(4){
    width: 30%;
  }

  /* ===== GRÚA: alineado bonito y centrado ===== */
  .grua-cell{
    padding: 8px 10px;
  }
  .grua-options{
    display: flex;
    align-items: center;
    justify-content: center;   /* centrado */
    gap: 60px;                 /* separación entre Sí y No */
    flex-wrap: wrap;
  }
  .grua-opt{
    display: inline-flex;
    align-items: center;
    gap: 10px;
    font-weight: 700;
  }
  .grua-opt input{
    width: auto;               /* evita que se estire */
    transform: translateY(1px);
  }

  /* Firma */
  .firma-wrap{
    display:flex;
    gap:14px;
    align-items:flex-start;
    flex-wrap:wrap;
  }
  #firma{ border:1px solid #000; background:#fff; touch-action:none; }
  .firma-hint{ font-size:13px; color:#333; max-width:360px; line-height:1.35; }

  /* ===== IMPRESIÓN A PDF (limpia) ===== */
  @media print {
    @page { size: A4; margin: 10mm; }
    body { background:#fff !important; }
    .container { width:100%; margin:0; padding:0; }
    .btn, .actions, .no-print { display:none !important; }
    table, tr, td, th { page-break-inside: avoid; }
    h3 { page-break-after: avoid; }
    textarea { border: 1px solid #000; }
  }
/* === FOTOS DEL VEHÍCULO === */
#galeria img{
  width: 180px;
  height: 120px;
  object-fit: cover;
  border: 1px solid #000;
}

@media print{
  #fotos{ display:none !important; }
}
</style>
</head>

<body>

<div class="container" id="orden">
  <div class="header">
    <img src="./logo-mayworkz.png" alt="MAYWORKZ" />
    <h2>ORDEN DE SERVICIO AUTOMOTRIZ</h2>
  </div>

  <!-- DATOS -->
  <table class="datos">
    <tr>
      <th colspan="2">DATOS DEL VEHÍCULO</th>
      <th colspan="2">DATOS DEL CLIENTE</th>
    </tr>
    <tr>
      <td>Marca</td><td><input></td>
      <td>Nombre</td><td><input placeholder="Ej. Rubén Rodríguez"></td>
    </tr>
    <tr>
      <td>Modelo</td><td><input></td>
      <td>Teléfono</td><td><input placeholder="Ej. 33-00-00-00-00"></td>
    </tr>
    <tr>
      <td>Año</td><td><input></td>
      <td>Email</td><td><input></td>
    </tr>
    <tr>
      <td>Color</td><td><input></td>
      <td>Ingreso</td><td><input type="date"></td>
    </tr>
    <tr>
      <td>Placas</td><td><input></td>
      <td>Salida</td><td><input type="date"></td>
    </tr>
    <tr>
      <td>Kilometraje</td><td><input></td>
      <td>Núm. de serie</td><td><input></td>
    </tr>
    <tr>
      <td>Ingreso en grúa</td>
      <td colspan="3" class="grua-cell">
        <div class="grua-options">
          <label class="grua-opt"><input type="radio" name="grua" value="si"> Sí</label>
          <label class="grua-opt"><input type="radio" name="grua" value="no"> No</label>
        </div>
      </td>
    </tr>
  </table>

  <!-- TRABAJO A REALIZAR -->
  <h3>TRABAJO A REALIZAR</h3>
  <textarea class="trabajo" rows="4" placeholder="• Cambio de aro dentado
• Servicio de marcha
• Servicio y reparación de carburador"></textarea>

  <!-- TABLA DE COSTOS -->
  <table id="tabla">
    <tr>
      <th style="width: 90px;">CANT.</th>
      <th>DESCRIPCIÓN</th>
      <th style="width: 160px;">PRECIO UNIT.</th>
      <th style="width: 140px;">TOTAL</th>
    </tr>
    <tr>
      <td><input type="number" value="1" min="0" step="1" oninput="calcular()" /></td>
      <td><input placeholder="Ej. Mano de obra / Refacción" /></td>
      <td><input type="number" value="0" min="0" step="0.01" oninput="calcular()" /></td>
      <td class="lineTotal">$0.00</td>
    </tr>
  </table>

  <div class="actions">
    <button class="btn secondary" type="button" onclick="agregarFila()">+ Agregar concepto</button>
  </div>

  <!-- TOTALES -->
  <table class="total-box">
    <tr><td>TOTAL</td><td id="subtotal">$0.00</td></tr>
  </table>

  <!-- OBSERVACIONES -->
  <h3>OBSERVACIONES</h3>
  <textarea class="obs" rows="3" placeholder="Detalles, autorización, piezas, tiempos, etc."></textarea>

<h3>FOTOS DEL VEHÍCULO</h3>
<input id="fotos" type="file" accept="image/*" multiple />
<div id="galeria" style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;"></div>


  <!-- INVENTARIO -->
  <h3>INVENTARIO</h3>
  <table>
    <tr><td>Gato</td><td style="width:60px; text-align:center;"><input type="checkbox"></td><td>Antena</td><td style="width:60px; text-align:center;"><input type="checkbox"></td></tr>
    <tr><td>Herramientas</td><td style="text-align:center;"><input type="checkbox"></td><td>Emblemas</td><td style="text-align:center;"><input type="checkbox"></td></tr>
    <tr><td>Triángulos</td><td style="text-align:center;"><input type="checkbox"></td><td>Tapones de ruedas</td><td style="text-align:center;"><input type="checkbox"></td></tr>
    <tr><td>Tapetes</td><td style="text-align:center;"><input type="checkbox"></td><td>Cables</td><td style="text-align:center;"><input type="checkbox"></td></tr>
    <tr><td>Llanta de refacción</td><td style="text-align:center;"><input type="checkbox"></td><td>Estéreo</td><td style="text-align:center;"><input type="checkbox"></td></tr>
    <tr><td>Extinguidor</td><td style="text-align:center;"><input type="checkbox"></td><td>Encendedor</td><td style="text-align:center;"><input type="checkbox"></td></tr>
  </table>

  <!-- GASOLINA -->
  <h3>NIVEL DE GASOLINA</h3>
  <table>
    <tr>
      <td style="text-align:center;"><label><input type="checkbox"> 25%</label></td>
      <td style="text-align:center;"><label><input type="checkbox"> 50%</label></td>
      <td style="text-align:center;"><label><input type="checkbox"> 75%</label></td>
      <td style="text-align:center;"><label><input type="checkbox"> 100%</label></td>
    </tr>
  </table>

  <!-- TESTIGOS -->
  <h3>TESTIGOS ENCENDIDOS</h3>
  <table>
    <tr>
      <td><label><input type="checkbox"> Airbag</label></td>
      <td><label><input type="checkbox"> Check Engine</label></td>
      <td><label><input type="checkbox"> ABS</label></td>
      <td><label><input type="checkbox"> Aceite</label></td>
    </tr>
    <tr>
      <td><label><input type="checkbox"> Batería</label></td>
      <td><label><input type="checkbox"> Cinturón</label></td>
      <td><label><input type="checkbox"> Freno</label></td>
      <td><label><input type="checkbox"> Luces</label></td>
    </tr>
  </table>

  <!-- FIRMA -->
  <h3>FIRMA DEL CLIENTE</h3>
  <div class="firma-wrap">
    <canvas id="firma" width="420" height="160"></canvas>
    <div class="firma-hint">
      Firma con el dedo (cel/tablet) o con el mouse (PC).<br>
      Si te equivocas, usa <b>Limpiar firma</b>.
      <div class="actions">
        <button class="btn secondary" type="button" onclick="limpiarFirma()">Limpiar firma</button>
      </div>
    </div>
  </div>

</div>

<div class="container" style="background:transparent; padding-top:0; padding-bottom:20px;">
  <button class="btn" type="button" onclick="descargarPDF()">Descargar PDF</button>
</div>

<script>
  function agregarFila() {
    const tabla = document.getElementById("tabla");
    const row = tabla.insertRow();
    row.innerHTML = `
      <td><input type="number" value="1" min="0" step="1" oninput="calcular()" /></td>
      <td><input placeholder="Descripción" /></td>
      <td><input type="number" value="0" min="0" step="0.01" oninput="calcular()" /></td>
      <td class="lineTotal">$0.00</td>
    `;
  }

  function calcular() {
    const filas = document.querySelectorAll("#tabla tr");
    let subtotal = 0;

    filas.forEach((fila, i) => {
      if (i === 0) return;
      const cant = parseFloat(fila.cells[0].querySelector("input").value) || 0;
      const precio = parseFloat(fila.cells[2].querySelector("input").value) || 0;
      const totalLinea = cant * precio;

      fila.cells[3].innerText = "$" + totalLinea.toFixed(2);
      subtotal += totalLinea;
    });

 
    document.getElementById("subtotal").innerText = "$" + subtotal.toFixed(2);
    document.getElementById("total").innerText = "$" + total.toFixed(2);
  }

  // ===== FIRMA (mouse + touch) =====
  const canvas = document.getElementById("firma");
  const ctx = canvas.getContext("2d");
  let dibujando = false;

  function posEnCanvas(clientX, clientY) {
    const rect = canvas.getBoundingClientRect();
    return { x: clientX - rect.left, y: clientY - rect.top };
  }

  function empezarTrazo(x, y) {
    dibujando = true;
    ctx.beginPath();
    ctx.moveTo(x, y);
  }

  function trazar(x, y) {
    if (!dibujando) return;
    ctx.lineWidth = 2.2;
    ctx.lineCap = "round";
    ctx.lineTo(x, y);
    ctx.stroke();
  }

  function terminarTrazo() {
    dibujando = false;
    ctx.beginPath();
  }

  canvas.addEventListener("mousedown", (e) => {
    const p = posEnCanvas(e.clientX, e.clientY);
    empezarTrazo(p.x, p.y);
  });
  canvas.addEventListener("mousemove", (e) => {
    const p = posEnCanvas(e.clientX, e.clientY);
    trazar(p.x, p.y);
  });
  window.addEventListener("mouseup", terminarTrazo);
  canvas.addEventListener("mouseleave", terminarTrazo);

  canvas.addEventListener("touchstart", (e) => {
    e.preventDefault();
    const t = e.touches[0];
    const p = posEnCanvas(t.clientX, t.clientY);
    empezarTrazo(p.x, p.y);
  }, { passive: false });

  canvas.addEventListener("touchmove", (e) => {
    e.preventDefault();
    const t = e.touches[0];
    const p = posEnCanvas(t.clientX, t.clientY);
    trazar(p.x, p.y);
  }, { passive: false });

  canvas.addEventListener("touchend", (e) => {
    e.preventDefault();
    terminarTrazo();
  }, { passive: false });

  function limpiarFirma() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

function descargarPDF() {
  if (totalFotos < 4) {
    alert("Debes agregar al menos 4 fotos del vehículo antes de descargar el PDF.");
    return;
  }

  const originalTitle = document.title;
  document.title = "Orden de Servicio - MAYWORKZ";

  // pequeño delay para asegurar que las imágenes estén listas
  setTimeout(() => {
    window.print();
    document.title = originalTitle;
  }, 600);
}

// === FOTOS DEL VEHÍCULO (mínimo 4) ===
const inputFotos = document.getElementById("fotos");
const galeria = document.getElementById("galeria");
let totalFotos = 0;

if (inputFotos) {
  inputFotos.addEventListener("change", () => {
    galeria.innerHTML = "";
    totalFotos = 0;

    const files = Array.from(inputFotos.files || []);

    files.forEach(file => {
      if (!file.type.startsWith("image/")) return;

      const img = document.createElement("img");
      img.onload = () => totalFotos++;
      img.src = URL.createObjectURL(file);
      galeria.appendChild(img);
    });
  });
}

  calcular();

</script>

</body>
</html>

